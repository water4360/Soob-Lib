-----------------------------------------------------------------------------
--RENTAL관련

CREATE TABLE RENTAL (
    NO VARCHAR(10) PRIMARY KEY,
    TITLE VARCHAR(100) NOT NULL,
    AUTHOR VARCHAR(50) NOT NULL,
    PUBLISHER VARCHAR(50),
    RENT_ID VARCHAR(20) NOT NULL,
    REN_DATE DATE DEFAULT(SYSDATE) NOT NULL,
    DUE_DATE DATE DEFAULT(SYSDATE+3) NOT NULL,
    OVERDUE_STATE NUMBER(10) DEFAULT(DUE_DATE - REN_DATE) NOT NULL,
    FOREIGN KEY (NO) REFERENCES BOOKLIST (NO),
    CONSTRAINT CHK_RENTAL_RENT_ID CHECK (RENT_ID IS NULL)
);


--날짜반영해서 1차 수정
CREATE TABLE RENTAL (
    NO VARCHAR(10) PRIMARY KEY,
    TITLE VARCHAR(100) NOT NULL,
    AUTHOR VARCHAR(50) NOT NULL,
    PUBLISHER VARCHAR(50),
    RENT_ID VARCHAR(20),
    REN_DATE DATE DEFAULT SYSDATE NOT NULL,
    DUE_DATE DATE DEFAULT (SYSDATE + INTERVAL '3' DAY) NOT NULL,
    OVERDUE_STATE NUMBER(10) GENERATED ALWAYS AS (DUE_DATE - REN_DATE) VIRTUAL NOT NULL,
    FOREIGN KEY (NO) REFERENCES BOOKLIST (NO),
    CONSTRAINT CHK_RENTAL_RENT_ID CHECK (RENT_ID IS NOT NULL)
);





--테이블 확인
SELECT * FROM RENTAL;
DROP TABLE RENTAL;
COMMIT;


UPDATE RENTAL SET OVERDUE_STATE = TRUNC(DUE_DATE - SYSDATE) ;

UPDATE RENTAL SET OVERDUE_STATE = TRUNC(DUE_DATE - SYSDATE) WHERE RENT_ID = 'hari1004' ;

UPDATE RENTAL SET OVERDUE_STATE = TRUNC(DUE_DATE - SYSDATE) WHERE RENT_ID = 'test' ;
 

UPDATE RENTAL SET REN_DATE = TO_DATE('230420', 'YY/MM/DD'), DUE_DATE = TO_DATE('230423', 'YY/MM/DD') WHERE NO = '230009' ;

DELETE FROM RENTAL WHERE NO = '230002' ;

UPDATE RENTAL SET OVERDUE_STATE = ROUND(DUE_DATE - SYSDATE) WHERE RENT_ID ='hari1004' AND NO = '230009' ;


--테이블명 수정            
ALTER TABLE RENTAL RENAME COLUMN EXP_DATE TO DUE_DATE;

--테이블 통째로 삭제
DROP TABLE RENTAL;

--데이터 삽입
INSERT INTO RENTAL(NO, TITLE, AUTHOR, PUBLISHER, RENT_ID)
            VALUES(230001, '제목', '작가', '출판사', '대여자ID');

 
 


INSERT INTO RENTAL(NO, TITLE, AUTHOR, PUBLISHER, RENT_ID, REN_DATE, DUE_DATE)
            VALUES(230001, '제목', '작가', '출판사', '대여자ID', SYSDATE, SYSDATE + 3 );
            
           
INSERT INTO RENTAL(NO, TITLE, AUTHOR, PUBLISHER, RENT_ID, OVERDUE_STATE)
            VALUES(230999, '제목', '작가', '출판사', '대여자ID', (TO_DATE('20230415', 'YYYY-MM-DD')-TO_DATE('20230410', 'YYYY-MM-DD')));

INSERT INTO RENTAL(NO, TITLE, AUTHOR, PUBLISHER, RENT_ID)
            VALUES(230997, '제목', '작가', '출판사', '대여자ID');
            


SELECT RENTAL.*, ROUND(SYSDATE-DUE_DATE) AS OVERDUE FROM RENTAL WHERE RENT_ID = 'hari1004'; 


--날짜 테스트용
--날짜가 지나면...오늘날짜SYSDATE - DUE_DATE를 해야할듯?
SELECT  (TO_DATE('20230410', 'YYYY-MM-DD')-TO_DATE('20230415', 'YYYY-MM-DD')) AS OVERDUE_DATE, TRUNC(SYSDATE+1) FROM DUAL;

SELECT (SYSDATE-SYSDATE + 3) AS DATEE FROM DUAL;

--데이터 수정
UPDATE RENTAL SET REN_DATE = '20230425' WHERE NO = '230001';
UPDATE RENTAL SET RENT_ID = 'test' WHERE TITLE = '제목';

UPDATE RENTAL SET OVERDUE_STATE = DUE_DATE-SYSDATE;

--행 삭제
DELETE FROM RENTAL WHERE NO = '230022' ;



                    
ROLLBACK;
        



COMMIT;
